import{a as G,r,j as a,S as U,T as B,V as H,R as J}from"./index-Dl0dYXn5.js";import{d as A}from"./dayjs.min-Ccw0QmwY.js";import{u as K,d as L,m as C,e as h}from"./mainHttpService-DghYvVay.js";import{D as I,f as Y,T,H as X,a as Z,A as D,F as ee,b as N,c as _,d as R,C as te,I as ae,e as se,M as z,g as re,h as oe}from"./index-BzjS3VuL.js";import{u as ne}from"./useProject-BxUMNQtp.js";const le=(t,l,u,m,p,c)=>[{title:"AUTHOR",key:"author",renderHead:t,renderBody:l},{title:"FUNCTION",key:"function",renderHead:t,renderBody:u},{title:"STATUS",key:"status",renderHead:t,renderBody:m},{title:"EMPLOYED",key:"employed",renderHead:t,renderBody:p},{title:"",key:"action",renderBody:c,renderHead:t}],ie=(t,l,u,m,p,c)=>[{title:"COMPANIES",key:"companies",renderHead:t,renderBody:l},{title:"BUDGET",key:"budget",renderHead:t,renderBody:u},{title:"STATUS",key:"status",renderHead:t,renderBody:m},{title:"COMPLETION",key:"completion",renderHead:t,renderBody:p},{title:"",key:"action",renderBody:c,renderHead:t}];var Q=(t=>(t.ONLINE="Online",t.OFFLINE="Offline",t))(Q||{});const de=()=>{const t=G(),{data:l,isLoading:u,isFetching:m}=K({queryKey:[h.AUTHOR],queryFn:async()=>(await C.get(h.AUTHOR)).data,refetchOnWindowFocus:!1}),p=(l==null?void 0:l.records)||[],{mutateAsync:c}=L({mutationFn:async n=>(await C.post(h.AUTHOR,n)).data,onSuccess:n=>{const f=n.records;t.setQueryData([h.AUTHOR],s=>({records:[...f,...s.records]}))}}),{mutateAsync:x}=L({mutationFn:async n=>(await C.put(h.AUTHOR,n)).data,onSuccess:async(n,f)=>{const s=f.records.map(i=>i);t.setQueryData([h.AUTHOR],i=>({records:i.records.map(d=>d.id===s[0].id?{...d,fields:{...d.fields,name:s[0].fields.name,email:s[0].fields.email,avatar:s[0].fields.avatar,role:s[0].fields.role,job:s[0].fields.job,employed:s[0].fields.employed}}:d)}))}});return{authorData:p,isLoading:u,isFetching:m,createAuthor:c,updateAuthor:x}},ce=(t=[])=>t.map(l=>{const{id:u,fields:m,createdTime:p}=l||{},{_id:c,name:x,email:n,avatar:f,role:s,job:i,status:d,employed:y}=m||{};return{id:u,createdTime:p,fields:{_id:c,name:x,email:n,avatar:f||"/imgs/avatar-default.svg",role:s,job:i,status:d,employed:A(y).format(I)},name:x,email:n,avatar:f||"/imgs/avatar-default.svg",role:s,job:i,authorStatus:d||Q.OFFLINE,employed:A(y).format(I)}}),ue=(t=[])=>t.map(l=>{const{id:u,fields:m,createdTime:p}=l||{},{_id:c,projectName:x,avatar:n,budget:f,status:s,completion:i,description:d,image:y}=m||{};return{id:u,createdTime:p,fields:{_id:c,projectName:x,avatar:n,budget:f,status:s,projectStatus:s,completion:i,description:d,image:y},projectName:x,avatar:n,budget:`$${Y(f)}`,status:s,projectStatus:s,completion:i,description:d,image:y}}),he=()=>{const[t,l]=r.useState(!1),{authorData:u,isLoading:m,isFetching:p,createAuthor:c,updateAuthor:x}=de(),{projectData:n,isLoading:f,isFetching:s}=ne(),i=()=>{l(e=>!e)},d=r.useCallback(async e=>{try{const o={records:[{fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:A(e.fields.employed).format(T)}}]};await c(o)}catch(o){throw o}},[c]),y=r.useCallback(async e=>{try{const o={records:[{id:e.id,fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:A(e.fields.employed).format(T)}}]};await x(o)}catch(o){throw o}},[x]),W=r.useCallback(e=>{e.id?y(e):d(e)},[d,y]),j=r.useCallback((e,o)=>e?a.jsx(X,{title:e},o):a.jsx(Z,{w:50,maxW:50}),[]),O=r.useCallback(({id:e,name:o,avatar:b,email:V})=>a.jsx(D,{id:e,name:o,image:b,email:V},e),[]),g=r.useCallback(({role:e,job:o})=>a.jsx(ee,{role:e,job:o}),[]),k=r.useCallback(({authorStatus:e})=>a.jsx(N,{isAuthor:!0,variant:U[`${e}`],text:e}),[]),S=r.useCallback(({projectStatus:e})=>a.jsx(N,{variant:U[`${e}`],text:e}),[]),M=r.useCallback(({employed:e})=>a.jsx(_,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:a.jsx(B,{fontSize:"md",whiteSpace:"break-spaces",noOfLines:1,w:{base:"100px","3xl":"150px","5xl":"200px"},flex:1,color:"text.200",fontWeight:"bold",children:A(e).format(T)})}),[]),v=r.useCallback(e=>a.jsx(R,{isAuthor:!0,data:e,onUpdateAuthor:y}),[]),F=r.useCallback(e=>a.jsx(R,{dataProject:e,isOpenOption:!0}),[]),w=r.useCallback(({id:e,avatar:o,projectName:b})=>a.jsx(D,{id:e,name:b,image:o},e),[]),E=r.useCallback(({budget:e})=>a.jsx(_,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:a.jsx(B,{flex:1,w:{base:"100px","3xl":"150px","5xl":"200px"},noOfLines:1,color:"text.primary",fontWeight:"bold",fontSize:"md",whiteSpace:"break-spaces",children:e})}),[]),P=r.useCallback(({completion:e})=>a.jsx(te,{completion:e}),[]),$=r.useMemo(()=>le(j,O,g,k,M,v),[j,O,g,k,M,v]),q=r.useMemo(()=>ie(j,w,E,S,P,F),[j,w,E,S,P,F]);return a.jsx(ae,{isOpen:m&&f,children:a.jsxs(H,{alignItems:"flex-start",children:[a.jsx(se,{name:"Tables",path:J.TABLES}),a.jsxs(H,{gap:"24px",w:"100%",children:[a.jsx(z,{isAuthor:!0,title:"Authors Table",columns:$,dataSource:ce(u),onClickAdd:i,isFetching:p}),a.jsx(z,{title:"Projects",columns:q,dataSource:ue(n),isFetching:s})]}),t&&a.jsx(re,{isOpen:t,onClose:i,title:"Add Author",haveCloseButton:!0,body:a.jsx(oe,{onCloseModal:i,onSubmit:W})})]})})};export{he as default};
