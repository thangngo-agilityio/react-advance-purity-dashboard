import{e as te,f as se,g as B,m as O,h as T,r as a,D as ae,i as C,k as H,l as re,n as g,S as j,j as s,o as oe,p as ne,q as N,s as le,t as R,v as z,w as G,T as $,x as q,C as ce,I as ie,V as Q,y as de,R as ue,M as V,z as me,G as pe}from"./index-D9fj5dMq.js";import{u as fe}from"./useProject-CMFKGcol.js";import{u as he}from"./chunk-6RSEZNRH-TtWsfxA4.js";const xe=(t,l,o,d,c,m)=>[{title:"AUTHOR",key:"author",renderHead:t,renderBody:l},{title:"FUNCTION",key:"function",renderHead:t,renderBody:o},{title:"STATUS",key:"status",renderHead:t,renderBody:d},{title:"EMPLOYED",key:"employed",renderHead:t,renderBody:c},{title:"",key:"action",renderBody:m,renderHead:t}],ye=(t,l,o,d,c,m)=>[{title:"COMPANIES",key:"companies",renderHead:t,renderBody:l},{title:"BUDGET",key:"budget",renderHead:t,renderBody:o},{title:"STATUS",key:"status",renderHead:t,renderBody:d},{title:"COMPLETION",key:"completion",renderHead:t,renderBody:c},{title:"",key:"action",renderBody:m,renderHead:t}];var W=(t=>(t.ONLINE="Online",t.OFFLINE="Offline",t))(W||{});const Ae=t=>{const l=te(),{name:o}=Object.assign({name:""},t),d={params:o},{data:c,isLoading:m,isFetching:h}=se({queryKey:[T.AUTHOR,o],queryFn:async()=>(await O.get(`${T.AUTHOR}?view=Grid%20view`,d)).data,refetchOnWindowFocus:!1}),x=(c==null?void 0:c.records)||[],{mutateAsync:f}=B({mutationFn:async i=>(await O.post(T.AUTHOR,i)).data,onSuccess:i=>{const p=i.records;l.setQueryData([T.AUTHOR],n=>({records:[...p,...n.records]}))}}),{mutateAsync:u}=B({mutationFn:async i=>(await O.put(T.AUTHOR,i)).data,onSuccess:async(i,p)=>{const n=p.records.map(A=>A);l.setQueryData([T.AUTHOR],A=>({records:A.records.map(y=>y.id===n[0].id?{...y,fields:{...y.fields,name:n[0].fields.name,email:n[0].fields.email,avatar:n[0].fields.avatar,role:n[0].fields.role,job:n[0].fields.job,employed:n[0].fields.employed}}:y)}))}});return{authorData:x,isLoading:m,isFetching:h,createAuthor:f,updateAuthor:u}},Te=(t,l)=>{const o=a.useRef(null);return a.useCallback((...d)=>{o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{t(...d)},ae)},l)},je=(t=[])=>t.map(l=>{const{id:o,fields:d,createdTime:c}=l||{},{_id:m,name:h,email:x,avatar:f,role:u,job:i,status:p,employed:n}=d||{};return{id:o,createdTime:c,fields:{_id:m,name:h,email:x,avatar:f||"/imgs/avatar-default.svg",role:u,job:i,status:p,employed:C(n).format(H)},name:h,email:x,avatar:f||"/imgs/avatar-default.svg",role:u,job:i,authorStatus:p||W.OFFLINE,employed:C(n).format(H)}}),Ce=(t=[])=>t.map(l=>{const{id:o,fields:d,createdTime:c}=l||{},{_id:m,projectName:h,avatar:x,budget:f,status:u,completion:i,description:p,image:n}=d||{};return{id:o,createdTime:c,fields:{_id:m,projectName:h,avatar:x,budget:f,status:u,projectStatus:u,completion:i,description:p,image:n},projectName:h,avatar:x,budget:`$${re(f)}`,status:u,projectStatus:u,completion:i,description:p,image:n}}),Oe=()=>{const[t,l]=a.useState(""),[o,d]=a.useState(!1),c=he(),{authorData:m,isLoading:h,isFetching:x,createAuthor:f,updateAuthor:u}=Ae({name:t}),{projectData:i,isLoading:p,isFetching:n,updateProject:A}=fe(),y=()=>{d(e=>!e)},k=a.useCallback(async e=>{try{const r={records:[{fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(g)}}]};await f(r),c({title:j.TITLE_MESSAGE_CREATE("Author"),description:j.AUTHOR_SUCCESS,status:"success",duration:2e3,isClosable:!0})}catch(r){throw r}},[f]),b=a.useCallback(async e=>{try{const r={records:[{id:e.id,fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(g)}}]};await u(r),c({title:j.TITLE_MESSAGE_UPDATE("Author"),description:j.AUTHOR_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(r){throw r}},[u]),J=a.useCallback(async e=>{try{const r={records:[{id:e.id,fields:{projectName:e.fields.projectName,avatar:e.fields.avatar,budget:e.fields.budget,status:e.fields.status,completion:e.fields.completion,description:e.fields.description}}]};await A(r),c({title:j.TITLE_MESSAGE_UPDATE("Project"),description:j.PROJECT_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(r){throw r}},[A]),K=a.useCallback(e=>{e.id?b(e):k(e)},[k,b]),Y=Te(e=>{l(e)},[l]),S=a.useCallback((e,r)=>e?s.jsx(oe,{title:e},r):s.jsx(ne,{w:50,maxW:50}),[]),U=a.useCallback(({id:e,name:r,avatar:E,email:ee})=>s.jsx(N,{id:e,name:r,image:E,email:ee},e),[]),M=a.useCallback(({role:e,job:r})=>s.jsx(le,{role:e,job:r}),[]),P=a.useCallback(({authorStatus:e})=>s.jsx(R,{isAuthor:!0,variant:z[`${e}`],text:e}),[]),v=a.useCallback(({projectStatus:e})=>s.jsx(R,{variant:z[`${e}`],text:e}),[]),w=a.useCallback(({employed:e})=>s.jsx(G,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:s.jsx($,{fontSize:"md",whiteSpace:"break-spaces",noOfLines:1,w:{base:"100px","3xl":"150px","5xl":"200px"},flex:1,color:"text.200",fontWeight:"bold",children:C(e).format(g)})}),[]),_=a.useCallback(e=>s.jsx(q,{isAuthor:!0,data:e,onUpdateAuthor:b}),[b]),D=a.useCallback(e=>s.jsx(q,{dataProject:e,isOpenOption:!0,onUpdateProject:J}),[]),F=a.useCallback(({id:e,avatar:r,projectName:E})=>s.jsx(N,{id:e,name:E,image:r},e),[]),L=a.useCallback(({budget:e})=>s.jsx(G,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:s.jsx($,{flex:1,w:{base:"100px","3xl":"150px","5xl":"200px"},noOfLines:1,color:"text.primary",fontWeight:"bold",fontSize:"md",whiteSpace:"break-spaces",children:e})}),[]),I=a.useCallback(({completion:e})=>s.jsx(ce,{completion:e}),[]),X=a.useMemo(()=>xe(S,U,M,P,w,_),[S,U,M,P,w,_]),Z=a.useMemo(()=>ye(S,F,L,v,I,D),[S,F,L,v,I,D]);return s.jsx(ie,{isOpen:h&&p,children:s.jsxs(Q,{alignItems:"flex-start",children:[s.jsx(de,{name:"Tables",path:ue.TABLES,onSearch:Y,searchValue:t}),s.jsxs(Q,{gap:"24px",w:"100%",children:[s.jsx(V,{isAuthor:!0,title:"Authors Table",columns:X,dataSource:je(m),onClickAdd:y,isFetching:x}),s.jsx(V,{title:"Projects",columns:Z,dataSource:Ce(i),isFetching:n})]}),o&&s.jsx(me,{isOpen:o,onClose:y,title:"Add Author",haveCloseButton:!0,body:s.jsx(pe,{onCloseModal:y,onSubmit:K})})]})})};export{Oe as default};
