import{v as oe,Z as le,U as ne,j as t,t as ie,i as ce,_ as de,r as l,$ as xe,a0 as C,a1 as T,a2 as pe,a3 as ue,a4 as y,F as V,V as w,H as J,T as A,a5 as me,B as fe,a6 as he,a7 as K,S as b,a8 as W,a9 as $,aa as je,R as be,ab as D,ac as ge,ad as ye}from"./index-BYFe5Z3H.js";import{A as Ae,u as Se}from"./useProject-DTh-A5i2.js";import{I as Ce}from"./index-C6HPhteo.js";import{u as Te,a as G,m as k,A as g}from"./mainHttpService-Ufr4JT5f.js";import{u as we}from"./chunk-6RSEZNRH-DEaiUcT8.js";var Y=oe(function(a,r){const o=le("Badge",a),{className:x,...n}=ne(a);return t.jsx(ie.span,{ref:r,className:ce("chakra-badge",a.className),...n,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Y.displayName="Badge";const ve=(s,a,r,o,x,n)=>[{title:"AUTHOR",key:"author",renderHead:s,renderBody:a},{title:"FUNCTION",key:"function",renderHead:s,renderBody:r},{title:"STATUS",key:"status",renderHead:s,renderBody:o},{title:"EMPLOYED",key:"employed",renderHead:s,renderBody:x},{title:"",key:"action",renderBody:n,renderHead:s}],Ee=(s,a,r,o,x,n)=>[{title:"COMPANIES",key:"companies",renderHead:s,renderBody:a},{title:"BUDGET",key:"budget",renderHead:s,renderBody:r},{title:"STATUS",key:"status",renderHead:s,renderBody:o},{title:"COMPLETION",key:"completion",renderHead:s,renderBody:x},{title:"",key:"action",renderBody:n,renderHead:s}];var Z=(s=>(s.ONLINE="Online",s.OFFLINE="Offline",s))(Z||{});const Oe=s=>{const a=de(),{name:r}=Object.assign({name:""},s),{data:o,isLoading:x,isFetching:n}=Te({queryKey:[g.AUTHOR,r],queryFn:async()=>(await k.get(`${g.AUTHOR}?view=Grid%20view&filterByFormula=SEARCH('${r}',{name})`)).data,refetchOnWindowFocus:!1}),p=(o==null?void 0:o.records)||[],{mutateAsync:h}=G({mutationFn:async d=>(await k.post(g.AUTHOR,d)).data,onSuccess:d=>{const u=d.records;a.setQueryData([g.AUTHOR,r],i=>({records:[...u,...(i==null?void 0:i.records)||[]]}))}}),{mutateAsync:f}=G({mutationFn:async d=>(await k.put(g.AUTHOR,d)).data,onSuccess:async(d,u)=>{const i=u.records;a.setQueryData([g.AUTHOR,r],m=>{var S;return{records:(S=m==null?void 0:m.records)==null?void 0:S.map(j=>j.id===i[0].id?{...j,fields:{...j.fields,name:i[0].fields.name,email:i[0].fields.email,avatar:i[0].fields.avatar,role:i[0].fields.role,job:i[0].fields.job,employed:i[0].fields.employed}}:j)}})}});return{authorData:p,isLoading:x,isFetching:n,createAuthor:h,updateAuthor:f}},ke=(s,a)=>{const r=l.useRef(null);return l.useCallback((...o)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s(...o)},xe)},a)},Pe=(s=[])=>s.map(a=>{const{id:r,fields:o,createdTime:x}=a||{},{_id:n,name:p,email:h,avatar:f,role:d,job:u,status:i,employed:m}=o||{};return{id:r,createdTime:x,fields:{_id:n,name:p,email:h,avatar:f||"/imgs/avatar-default.svg",role:d,job:u,status:i,employed:C(m).format(T)},name:p,email:h,avatar:f||"/imgs/avatar-default.svg",role:d,job:u,authorStatus:i||Z.OFFLINE,employed:C(m).format(T)}}),Ue=(s=[])=>s.map(a=>{const{id:r,fields:o,createdTime:x}=a||{},{_id:n,projectName:p,avatar:h,budget:f,status:d,completion:u,description:i,image:m}=o||{};return{id:r,createdTime:x,fields:{_id:n,projectName:p,avatar:h||"/imgs/avatar-default.svg",budget:f,status:d,projectStatus:d,completion:u,description:i,image:m||"imgs/image-project-default.jpg"},projectName:p,avatar:h||"/imgs/avatar-default.svg",budget:`$${pe(f)}`,status:d,projectStatus:d,completion:u,description:i,image:m||"imgs/image-project-default.jpg"}}),Be=s=>{const a={};return Object.entries(s).forEach(([r,o])=>{["",null,void 0].includes(o)||(a[r]=`${o}`)}),a},Le=s=>{const[a,r]=ue(s||{}),o=l.useMemo(()=>{let n={};return Object.keys(s).forEach(p=>{n={...n,[p]:a.get(p)||""}}),n},[s,a]),x=l.useCallback((n,p)=>r(Be({...o,[n]:p})),[o,r]);return{searchParam:o,defaultQuery:a,setSearchParam:x}},Q=({image:s,name:a,email:r})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},children:t.jsxs(V,{alignItems:"center",pr:"20px",children:[t.jsx(Ae,{src:`${s}`,alt:`${a}`}),t.jsxs(w,{ml:"15px",alignItems:"flex-start",gap:0,children:[t.jsx(J,{size:"md",textOverflow:"ellipsis",overflow:"hidden",textTransform:"capitalize",w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},children:a}),t.jsx(A,{w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},variant:"tertiary",textOverflow:"ellipsis",overflow:"hidden",children:r})]})]})}),Me=({completion:s})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsxs(w,{alignItems:"flex-start",children:[t.jsxs(A,{color:"#38A169",fontWeight:"bold",children:[s,"%"]}),t.jsx(me,{w:"125px",borderRadius:"md",value:s,size:"xs",colorScheme:"green"})]})}),Ne=({job:s,role:a})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsxs(w,{gap:0,alignItems:"flex-start",pr:"20px",children:[t.jsx(J,{size:"md",textOverflow:"ellipsis",overflow:"hidden",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:a}),t.jsx(A,{variant:"tertiary",textOverflow:"ellipsis",overflow:"hidden",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:s})]})}),Ie=({text:s="",isAuthor:a,...r})=>t.jsx(y,{py:"5px",px:0,fontSize:"md",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(fe,{w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(he,{minW:"max-content",placement:"bottom",label:s,children:t.jsx(Y,{...r,maxW:a?"65px":"100px",whiteSpace:"break-spaces",noOfLines:1,textAlign:a?"center":"left",fontSize:"md",fontWeight:"bold",textTransform:"unset",children:s})})})}),q=Ie,_e=({title:s})=>t.jsx(K,{py:"12px",px:0,sx:{minW:{base:170,md:"unset"}},children:t.jsx(V,{alignItems:"center",gap:2,children:t.jsx(A,{textTransform:"none",fontSize:"xs",fontWeight:"bold",whiteSpace:"break-spaces",maxW:"200px",noOfLines:1,title:s,children:s})})},s),Fe=_e,De=()=>{var z;const[s,a]=l.useState(!1),r=we(),{searchParam:o,setSearchParam:x}=Le({name:""}),{authorData:n,isLoading:p,isFetching:h,createAuthor:f,updateAuthor:d}=Oe({name:(z=o==null?void 0:o.name)==null?void 0:z.toLowerCase()}),{projectData:u,isLoading:i,isFetching:m,updateProject:S}=Se(),j=()=>{a(e=>!e)},P=l.useCallback(async e=>{try{const c={records:[{fields:{name:e.fields.name.toLowerCase(),email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(T)}}]};await f(c),r({title:b.TITLE_MESSAGE_CREATE("Author"),description:b.AUTHOR_SUCCESS,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[f]),v=l.useCallback(async e=>{try{const c={records:[{id:e.id,fields:{name:e.fields.name.toLowerCase(),email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(T)}}]};await d(c),r({title:b.TITLE_MESSAGE_UPDATE("Author"),description:b.AUTHOR_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[d]),X=l.useCallback(async e=>{try{const c={records:[{id:e.id,fields:{projectName:e.fields.projectName,avatar:e.fields.avatar,budget:Number(e.fields.budget),status:e.fields.status,completion:Number(e.fields.completion),description:e.fields.description,image:e.fields.image}}]};await S(c),r({title:b.TITLE_MESSAGE_UPDATE("Project"),description:b.PROJECT_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[S]),ee=l.useCallback(e=>{e.id?v(e):P(e)},[P,v]),se=ke(e=>{x("name",e)},[]),E=l.useCallback((e,c)=>e?t.jsx(Fe,{title:e},c):t.jsx(K,{w:50,maxW:50}),[]),U=l.useCallback(({id:e,name:c,avatar:O,email:re})=>t.jsx(Q,{id:e,name:c,image:O,email:re},e),[]),B=l.useCallback(({role:e,job:c})=>t.jsx(Ne,{role:e,job:c}),[]),L=l.useCallback(({authorStatus:e})=>t.jsx(q,{isAuthor:!0,variant:W[`${e}`],text:e}),[]),M=l.useCallback(({projectStatus:e})=>t.jsx(q,{variant:W[`${e}`],text:e}),[]),N=l.useCallback(({employed:e})=>t.jsx(y,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:t.jsx(A,{fontSize:"md",whiteSpace:"break-spaces",noOfLines:1,w:{base:"100px","3xl":"150px","5xl":"200px"},flex:1,color:"text.200",fontWeight:"bold",children:C(e).format(T)})}),[]),I=l.useCallback(e=>t.jsx($,{isAuthor:!0,data:e,onUpdateAuthor:v}),[v]),_=l.useCallback(e=>t.jsx($,{dataProject:e,isOpenOption:!0,onUpdateProject:X}),[]),F=l.useCallback(({id:e,avatar:c,projectName:O})=>t.jsx(Q,{id:e,name:O,image:c},e),[]),H=l.useCallback(({budget:e})=>t.jsx(y,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(A,{flex:1,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},noOfLines:1,color:"text.primary",fontWeight:"bold",fontSize:"md",whiteSpace:"break-spaces",children:e})}),[]),R=l.useCallback(({completion:e})=>t.jsx(Me,{completion:e}),[]),te=l.useMemo(()=>ve(E,U,B,L,N,I),[E,U,B,L,N,I]),ae=l.useMemo(()=>Ee(E,F,H,M,R,_),[E,F,H,M,R,_]);return t.jsx(Ce,{isOpen:p&&i,children:t.jsxs(w,{alignItems:"flex-start",children:[t.jsx(je,{name:"Tables",path:be.TABLES,onSearch:se,searchValue:o==null?void 0:o.name}),t.jsxs(w,{gap:"24px",w:"100%",children:[t.jsx(D,{isAuthor:!0,title:"Authors Table",columns:te,dataSource:Pe(n),onClickAdd:j,isFetching:h}),t.jsx(D,{title:"Projects",columns:ae,dataSource:Ue(u),isFetching:m})]}),s&&t.jsx(ge,{isOpen:s,onClose:j,title:"Add Author",haveCloseButton:!0,body:t.jsx(ye,{onCloseModal:j,onSubmit:ee})})]})})};export{De as default};
