import{a as G,r as s,j as a,S as P,T as U,V as H,R as J}from"./index-DWvCvjbn.js";import{d as A}from"./dayjs.min-ucoJdO1o.js";import{u as K,d as L,m as C,e as h}from"./mainHttpService-CHTjrhU7.js";import{D as N,T,H as Y,a as X,A as I,F as Z,b as D,c as R,d as _,C as ee,I as te,e as ae,M as z,f as se,g as re}from"./index-DrCpUTlI.js";import{u as oe}from"./useProject-CADKnukV.js";const ne=(t,o,i,c,u,d)=>[{title:"AUTHOR",key:"author",renderHead:t,renderBody:o},{title:"FUNCTION",key:"function",renderHead:t,renderBody:i},{title:"STATUS",key:"status",renderHead:t,renderBody:c},{title:"EMPLOYED",key:"employed",renderHead:t,renderBody:u},{title:"",key:"action",renderBody:d,renderHead:t}],le=(t,o,i,c,u,d)=>[{title:"COMPANIES",key:"companies",renderHead:t,renderBody:o},{title:"BUDGET",key:"budget",renderHead:t,renderBody:i},{title:"STATUS",key:"status",renderHead:t,renderBody:c},{title:"COMPLETION",key:"completion",renderHead:t,renderBody:u},{title:"",key:"action",renderBody:d,renderHead:t}];var W=(t=>(t.ONLINE="Online",t.OFFLINE="Offline",t))(W||{});const ie=()=>{const t=G(),{data:o,isLoading:i,isFetching:c}=K({queryKey:[h.AUTHOR],queryFn:async()=>(await C.get(h.AUTHOR)).data}),u=(o==null?void 0:o.records)||[],{mutateAsync:d}=L({mutationFn:async l=>(await C.post(h.AUTHOR,l)).data,onSuccess:l=>{const x=l.records;t.setQueryData([h.AUTHOR],n=>({records:[...x,...n.records]}))}}),{mutateAsync:f}=L({mutationFn:async l=>(await C.put(h.AUTHOR,l)).data,onSuccess:async(l,x)=>{const n=x.records.map(m=>m);t.setQueryData([h.AUTHOR],m=>({records:m.records.map(p=>p.id===n[0].id?{...p,fields:{...p.fields,name:n[0].fields.name,email:n[0].fields.email,avatar:n[0].fields.avatar,role:n[0].fields.role,job:n[0].fields.job,employed:n[0].fields.employed}}:p)}))}});return{authorData:u,isLoading:i,isFetching:c,createAuthor:d,updateAuthor:f}},de=(t=[])=>t.map(o=>{const{id:i,fields:c,createdTime:u}=o||{},{_id:d,name:f,email:l,avatar:x,role:n,job:m,status:p,employed:y}=c||{};return{id:i,createdTime:u,fields:{_id:d,name:f,email:l,avatar:x||"/public/imgs/avatar-default.svg",role:n,job:m,status:p,employed:A(y).format(N)},name:f,email:l,avatar:x||"/public/imgs/avatar-default.svg",role:n,job:m,authorStatus:p||W.OFFLINE,employed:A(y).format(N)}}),ce=(t=0)=>Math.round(t).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),ue=(t=[])=>t.map(o=>{const{fields:i}=o||{},{projectName:c,avatar:u,budget:d,status:f,completion:l}=i||{};return{projectName:c,avatar:u,budget:`$${ce(d)}`,projectStatus:f,completion:l}}),he=()=>{const[t,o]=s.useState(!1),{authorData:i,isLoading:c,isFetching:u,createAuthor:d,updateAuthor:f}=ie(),{projectData:l,isLoading:x,isFetching:n}=oe(),m=()=>{o(e=>!e)},p=s.useCallback(async e=>{try{const r={records:[{fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:A(e.fields.employed).format(T)}}]};await d(r)}catch(r){throw r}},[d]),y=s.useCallback(async e=>{try{const r={records:[{id:e.id,fields:{name:e.fields.name,email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:A(e.fields.employed).format(T)}}]};await f(r)}catch(r){throw r}},[f]),Q=s.useCallback(e=>{e.id?y(e):p(e)},[p,y]),b=s.useCallback((e,r)=>e?a.jsx(Y,{title:e},r):a.jsx(X,{w:50,maxW:50}),[]),g=s.useCallback(({id:e,name:r,avatar:j,email:V})=>a.jsx(I,{id:e,name:r,image:j,email:V},e),[]),O=s.useCallback(({role:e,job:r})=>a.jsx(Z,{role:e,job:r}),[]),k=s.useCallback(({authorStatus:e})=>a.jsx(D,{isAuthor:!0,variant:P[`${e}`],text:e}),[]),S=s.useCallback(({projectStatus:e})=>a.jsx(D,{variant:P[`${e}`],text:e}),[]),M=s.useCallback(({employed:e})=>a.jsx(R,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:a.jsx(U,{fontSize:"md",whiteSpace:"break-spaces",noOfLines:1,w:{base:"100px","3xl":"150px","5xl":"200px"},flex:1,color:"text.200",fontWeight:"bold",children:A(e).format(T)})}),[]),v=s.useCallback(e=>a.jsx(_,{isAuthor:!0,data:e,onUpdateAuthor:y}),[]),F=s.useCallback(e=>a.jsx(_,{dataProject:e,isOpenOption:!0}),[]),w=s.useCallback(({id:e,avatar:r,projectName:j})=>a.jsx(I,{id:e,name:j,image:r},e),[]),E=s.useCallback(({budget:e})=>a.jsx(R,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:a.jsx(U,{flex:1,w:{base:"100px","3xl":"150px","5xl":"200px"},noOfLines:1,color:"text.primary",fontWeight:"bold",fontSize:"md",whiteSpace:"break-spaces",children:e})}),[]),B=s.useCallback(({completion:e})=>a.jsx(ee,{completion:e}),[]),$=s.useMemo(()=>ne(b,g,O,k,M,v),[b,g,O,k,M,v]),q=s.useMemo(()=>le(b,w,E,S,B,F),[b,w,E,S,B,F]);return a.jsx(te,{isOpen:c&&x,children:a.jsxs(H,{alignItems:"flex-start",children:[a.jsx(ae,{name:"Tables",path:J.TABLES}),a.jsxs(H,{gap:"24px",w:"100%",children:[a.jsx(z,{isAuthor:!0,title:"Authors Table",columns:$,dataSource:de(i),onClickAdd:m,isFetching:u}),a.jsx(z,{title:"Projects",columns:q,dataSource:ue(l),isFetching:n})]}),t&&a.jsx(se,{isOpen:t,onClose:m,title:"Add Author",haveCloseButton:!0,body:a.jsx(re,{onCloseModal:m,onSubmit:Q})})]})})};export{he as default};
