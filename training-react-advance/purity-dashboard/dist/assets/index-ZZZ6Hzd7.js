import{v as oe,Z as ne,U as le,j as t,t as ie,i as ce,_ as de,r as n,$ as xe,a0 as C,a1 as T,a2 as pe,a3 as ue,a4 as y,F as V,V as E,H as J,T as A,a5 as me,B as fe,a6 as he,a7 as K,S as b,a8 as W,a9 as $,aa as je,R as be,ab as D,ac as ge,ad as ye}from"./index-C3sPWvZH.js";import{A as Ae,u as Se}from"./useProject-B_ZQOowj.js";import{I as Ce}from"./index-CG-O5EEv.js";import{u as Te,a as G,m as v,A as g}from"./mainHttpService-G4ah1Toh.js";import{u as Ee}from"./chunk-6RSEZNRH-DjQRkq1H.js";var Y=oe(function(a,r){const o=ne("Badge",a),{className:x,...l}=le(a);return t.jsx(ie.span,{ref:r,className:ce("chakra-badge",a.className),...l,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Y.displayName="Badge";const we=(s,a,r,o,x,l)=>[{title:"AUTHOR",key:"author",renderHead:s,renderBody:a},{title:"FUNCTION",key:"function",renderHead:s,renderBody:r},{title:"STATUS",key:"status",renderHead:s,renderBody:o},{title:"EMPLOYED",key:"employed",renderHead:s,renderBody:x},{title:"",key:"action",renderBody:l,renderHead:s}],Oe=(s,a,r,o,x,l)=>[{title:"COMPANIES",key:"companies",renderHead:s,renderBody:a},{title:"BUDGET",key:"budget",renderHead:s,renderBody:r},{title:"STATUS",key:"status",renderHead:s,renderBody:o},{title:"COMPLETION",key:"completion",renderHead:s,renderBody:x},{title:"",key:"action",renderBody:l,renderHead:s}];var Z=(s=>(s.ONLINE="Online",s.OFFLINE="Offline",s))(Z||{});const ke=s=>{const a=de(),{name:r}=Object.assign({name:""},s),{data:o,isLoading:x,isFetching:l}=Te({queryKey:[g.AUTHOR,r],queryFn:async()=>(await v.get(`${g.AUTHOR}?view=Grid%20view&filterByFormula=SEARCH('${r}',{name})`)).data,refetchOnWindowFocus:!1}),p=(o==null?void 0:o.records)||[],{mutateAsync:h}=G({mutationFn:async d=>(await v.post(g.AUTHOR,d)).data,onSuccess:d=>{const u=d.records;a.setQueryData([g.AUTHOR,r],i=>({records:[...u,...(i==null?void 0:i.records)||[]]}))}}),{mutateAsync:f}=G({mutationFn:async d=>(await v.put(g.AUTHOR,d)).data,onSuccess:async(d,u)=>{const i=u.records;a.setQueryData([g.AUTHOR,r],m=>{var S;return{records:(S=m==null?void 0:m.records)==null?void 0:S.map(j=>j.id===i[0].id?{...j,fields:{...j.fields,name:i[0].fields.name,email:i[0].fields.email,avatar:i[0].fields.avatar,role:i[0].fields.role,job:i[0].fields.job,employed:i[0].fields.employed}}:j)}})}});return{authorData:p,isLoading:x,isFetching:l,createAuthor:h,updateAuthor:f}},ve=(s,a)=>{const r=n.useRef(null);return n.useCallback((...o)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{s(...o)},xe)},a)},Pe=(s=[])=>s.map(a=>{const{id:r,fields:o,createdTime:x}=a||{},{_id:l,name:p,email:h,avatar:f,role:d,job:u,status:i,employed:m}=o||{};return{id:r,createdTime:x,fields:{_id:l,name:p,email:h,avatar:f||"/imgs/avatar-default.svg",role:d,job:u,status:i,employed:C(m).format(T)},name:p,email:h,avatar:f||"/imgs/avatar-default.svg",role:d,job:u,authorStatus:i||Z.OFFLINE,employed:C(m).format(T)}}),Ue=(s=[])=>s.map(a=>{const{id:r,fields:o,createdTime:x}=a||{},{_id:l,projectName:p,avatar:h,budget:f,status:d,completion:u,description:i,image:m}=o||{};return{id:r,createdTime:x,fields:{_id:l,projectName:p,avatar:h||"/imgs/avatar-default.svg",budget:f,status:d,projectStatus:d,completion:u,description:i,image:m||"/imgs/image-project-default.jpg"},projectName:p,avatar:h||"/imgs/avatar-default.svg",budget:`$${pe(f)}`,status:d,projectStatus:d,completion:u,description:i,image:m||"/imgs/image-project-default.jpg"}}),Be=s=>{const a={};return Object.entries(s).forEach(([r,o])=>{["",null,void 0].includes(o)||(a[r]=`${o}`)}),a},Le=s=>{const[a,r]=ue(s||{}),o=n.useMemo(()=>{let l={};return Object.keys(s).forEach(p=>{l={...l,[p]:a.get(p)||""}}),l},[s,a]),x=n.useCallback((l,p)=>r(Be({...o,[l]:p})),[o,r]);return{searchParam:o,defaultQuery:a,setSearchParam:x}},Q=({image:s,name:a,email:r})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},children:t.jsxs(V,{alignItems:"center",pr:"20px",children:[t.jsx(Ae,{src:`${s}`,alt:`${a}`}),t.jsxs(E,{ml:"15px",alignItems:"flex-start",gap:0,children:[t.jsx(J,{w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},size:"md",textTransform:"capitalize",children:a}),t.jsx(A,{w:{base:"200px",xl:"220px","3xl":"450px","6xl":"450px"},variant:"tertiary",children:r})]})]})}),Me=({completion:s})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsxs(E,{alignItems:"flex-start",children:[t.jsxs(A,{color:"#38A169",fontWeight:"bold",children:[s,"%"]}),t.jsx(me,{w:"125px",borderRadius:"md",value:s,size:"xs",colorScheme:"green"})]})}),Ne=({job:s,role:a})=>t.jsx(y,{px:0,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsxs(E,{gap:0,alignItems:"flex-start",pr:"20px",children:[t.jsx(J,{w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},size:"md",children:a}),t.jsx(A,{w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},variant:"tertiary",children:s})]})}),Ie=({text:s="",isAuthor:a,...r})=>t.jsx(y,{py:"5px",px:0,fontSize:"md",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(fe,{w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(he,{minW:"max-content",placement:"bottom",label:s,children:t.jsx(Y,{...r,maxW:a?"65px":"100px",whiteSpace:"break-spaces",noOfLines:1,textAlign:a?"center":"left",fontSize:"md",fontWeight:"bold",textTransform:"unset",children:s})})})}),q=Ie,_e=({title:s})=>t.jsx(K,{py:"12px",px:0,sx:{minW:{base:170,md:"unset"}},children:t.jsx(V,{alignItems:"center",gap:2,children:t.jsx(A,{textTransform:"none",fontSize:"xs",fontWeight:"bold",whiteSpace:"break-spaces",maxW:"200px",noOfLines:1,title:s,children:s})})},s),Fe=_e,De=()=>{var z;const[s,a]=n.useState(!1),r=Ee(),{searchParam:o,setSearchParam:x}=Le({name:""}),{authorData:l,isLoading:p,isFetching:h,createAuthor:f,updateAuthor:d}=ke({name:(z=o==null?void 0:o.name)==null?void 0:z.toLowerCase()}),{projectData:u,isLoading:i,isFetching:m,updateProject:S}=Se(),j=()=>{a(e=>!e)},P=n.useCallback(async e=>{try{const c={records:[{fields:{name:e.fields.name.toLowerCase(),email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(T)}}]};await f(c),r({title:b.TITLE_MESSAGE_CREATE("Author"),description:b.AUTHOR_SUCCESS,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[f]),w=n.useCallback(async e=>{try{const c={records:[{id:e.id,fields:{name:e.fields.name.toLowerCase(),email:e.fields.email,avatar:e.fields.avatar,role:e.fields.role,job:e.fields.job,employed:C(e.fields.employed).format(T)}}]};await d(c),r({title:b.TITLE_MESSAGE_UPDATE("Author"),description:b.AUTHOR_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[d]),X=n.useCallback(async e=>{try{const c={records:[{id:e.id,fields:{projectName:e.fields.projectName,avatar:e.fields.avatar,budget:Number(e.fields.budget),status:e.fields.status,completion:Number(e.fields.completion),description:e.fields.description,image:e.fields.image}}]};await S(c),r({title:b.TITLE_MESSAGE_UPDATE("Project"),description:b.PROJECT_UPDATE,status:"success",duration:2e3,isClosable:!0})}catch(c){throw c}},[S]),ee=n.useCallback(e=>{e.id?w(e):P(e)},[P,w]),se=ve(e=>{x("name",e)},[]),O=n.useCallback((e,c)=>e?t.jsx(Fe,{title:e},c):t.jsx(K,{w:50,maxW:50}),[]),U=n.useCallback(({id:e,name:c,avatar:k,email:re})=>t.jsx(Q,{id:e,name:c,image:k,email:re},e),[]),B=n.useCallback(({role:e,job:c})=>t.jsx(Ne,{role:e,job:c}),[]),L=n.useCallback(({authorStatus:e})=>t.jsx(q,{isAuthor:!0,variant:W[`${e}`],text:e}),[]),M=n.useCallback(({projectStatus:e})=>t.jsx(q,{variant:W[`${e}`],text:e}),[]),N=n.useCallback(({employed:e})=>t.jsx(y,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"100px",md:"220px"},children:t.jsx(A,{fontSize:"md",whiteSpace:"break-spaces",noOfLines:1,w:{base:"100px","3xl":"150px","5xl":"200px"},flex:1,color:"text.200",fontWeight:"bold",children:C(e).format(T)})}),[]),I=n.useCallback(e=>t.jsx($,{isAuthor:!0,data:e,onUpdateAuthor:w}),[w]),_=n.useCallback(e=>t.jsx($,{dataProject:e,isOpenOption:!0,onUpdateProject:X}),[]),F=n.useCallback(({id:e,avatar:c,projectName:k})=>t.jsx(Q,{id:e,name:k,image:c},e),[]),H=n.useCallback(({budget:e})=>t.jsx(y,{py:"5px",pr:"5px",pl:0,fontSize:"md",textAlign:"left",w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},children:t.jsx(A,{flex:1,w:{base:"200px",xl:"220px","3xl":"250px","6xl":"350px"},noOfLines:1,color:"text.primary",fontWeight:"bold",fontSize:"md",whiteSpace:"break-spaces",children:e})}),[]),R=n.useCallback(({completion:e})=>t.jsx(Me,{completion:e}),[]),te=n.useMemo(()=>we(O,U,B,L,N,I),[O,U,B,L,N,I]),ae=n.useMemo(()=>Oe(O,F,H,M,R,_),[O,F,H,M,R,_]);return t.jsx(Ce,{isOpen:p&&i,children:t.jsxs(E,{alignItems:"flex-start",children:[t.jsx(je,{name:"Tables",path:be.TABLES,onSearch:se,searchValue:o==null?void 0:o.name}),t.jsxs(E,{gap:"24px",w:"100%",children:[t.jsx(D,{isAuthor:!0,title:"Authors Table",columns:te,dataSource:Pe(l),onClickAdd:j,isFetching:h}),t.jsx(D,{title:"Projects",columns:ae,dataSource:Ue(u),isFetching:m})]}),s&&t.jsx(ge,{isOpen:s,onClose:j,title:"Add Author",haveCloseButton:!0,body:t.jsx(ye,{onCloseModal:j,onSubmit:ee})})]})})};export{De as default};
